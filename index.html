<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mesin Prompt ‚Äî Veo3 (Gratis: HF/SD WebUI)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0f19;--panel:#12172a;--muted:#aab3c8;--text:#e8eeff;--acc:#7aa2ff;--line:#22305a}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:500 15px/1.6 Inter,system-ui}
    .card{background:linear-gradient(180deg,#12172a,#0f1430 70%);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 26px rgba(0,0,0,.25)}
    .pill{background:#0e1633;border:1px solid var(--line);padding:8px 10px;border-radius:999px;color:var(--muted);font-size:12px}
    .input,textarea,select{background:#0c1227;border:1px solid var(--line);border-radius:10px;padding:10px 12px;color:var(--text);width:100%}
    textarea{min-height:88px;resize:vertical}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;font-weight:800}
    .btn-primary{background:var(--acc);color:#061434}
    .btn-ghost{background:#0c1227;border:1px solid var(--line);color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .muted{color:var(--muted)} .hr{height:1px;background:var(--line)}
    .kbd{font-family:ui-monospace,Consolas,monospace;background:#0e1630;border:1px solid var(--line);padding:1px 6px;border-radius:6px}
    .link{color:#9ec1ff;text-decoration:underline}
    .danger{background:#ff6272;color:#1b0b0e}
    img.preview{max-height:220px;border-radius:10px;border:1px solid var(--line)}
  </style>
</head>
<body>
  <main class="max-w-7xl mx-auto p-4 sm:p-6">
    <header class="mb-5">
      <h1 class="text-2xl sm:text-3xl font-extrabold">Mesin Prompt JSON ‚Äî Veo3 (Gratis)</h1>
      <p class="muted">Teks: <b>Hugging Face Inference API</b> (default) atau OpenRouter. Gambar: <b>Stable Diffusion WebUI lokal</b> (gratis), opsional Replicate.</p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- PANEL KIRI -->
      <div class="card p-4 space-y-5 lg:col-span-1">

        <!-- PROVIDER TEKS -->
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="pill">Text Provider</span>
            <select id="textProvider" class="input w-auto">
              <option value="hf">Hugging Face (disarankan)</option>
              <option value="openrouter">OpenRouter (opsional)</option>
            </select>
          </div>

          <div id="hfBox" class="space-y-2">
            <div class="flex justify-between">
              <label class="muted text-sm">HF API Token (wajib untuk HF)</label>
              <a class="link text-xs" target="_blank" rel="noopener" href="https://huggingface.co/settings/tokens">Buat token</a>
            </div>
            <input id="hfKey" class="input" type="password" placeholder="hf_..."/>
            <label class="muted text-xs">Model (disarankan: <span class="kbd">google/gemma-2-9b-it</span>)</label>
            <input id="hfModel" class="input" value="google/gemma-2-9b-it"/>
          </div>

          <div id="orBox" class="space-y-2 hidden">
            <div class="flex justify-between">
              <label class="muted text-sm">OpenRouter API Key</label>
              <a class="link text-xs" target="_blank" rel="noopener" href="https://openrouter.ai">Daftar</a>
            </div>
            <input id="orKey" class="input" type="password" placeholder="sk-or-..."/>
            <label class="muted text-xs">Model (gratisan sering tersedia: <span class="kbd">google/gemma-2-9b-it:free</span>)</label>
            <input id="orModel" class="input" value="google/gemma-2-9b-it:free"/>
          </div>
        </div>

        <!-- PROVIDER GAMBAR -->
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="pill">Image Provider</span>
            <select id="imgProvider" class="input w-auto">
              <option value="sd_local">Stable Diffusion WebUI (lokal)</option>
              <option value="replicate">Replicate (opsional)</option>
            </select>
          </div>

          <div id="sdBox" class="space-y-2">
            <label class="muted text-sm">SD WebUI Base URL (lokal)</label>
            <input id="sdBase" class="input" value="http://127.0.0.1:7860"/>
            <p class="muted text-xs">Jalankan A1111 di PC-mu. Endpoint: <span class="kbd">/sdapi/v1/txt2img</span>. Tidak perlu API key.</p>
          </div>

          <div id="repBox" class="space-y-2 hidden">
            <div class="flex justify-between">
              <label class="muted text-sm">Replicate API Token</label>
              <a class="link text-xs" target="_blank" rel="noopener" href="https://replicate.com/account/api-tokens">Token</a>
            </div>
            <input id="repKey" class="input" type="password" placeholder="r8_..."/>
            <label class="muted text-xs">Model</label>
            <input id="repModel" class="input" value="black-forest-labs/flux-schnell"/>
          </div>
        </div>

        <!-- TOMBOL SIMPAN -->
        <div class="flex gap-2 flex-wrap">
          <button id="saveCfg" class="btn btn-ghost">üíæ Simpan Konfigurasi</button>
          <button id="clearCfg" class="btn danger">üóëÔ∏è Reset</button>
        </div>
        <p class="muted text-xs">Konfigurasi disimpan di <span class="kbd">localStorage</span> browser Anda.</p>

        <div class="hr my-1"></div>

        <!-- MODE -->
        <div class="flex items-center gap-2">
          <span class="pill">Mode</span>
          <select id="mode" class="input w-auto">
            <option value="hiburan">Hiburan (Cerita)</option>
            <option value="afiliasi">Afiliasi (Iklan 8s)</option>
          </select>
        </div>

        <!-- HIBURAN -->
        <div id="hiburanFields" class="space-y-3">
          <div>
            <label class="muted text-sm">Ide Karakter / Tokoh</label>
            <textarea id="charIdea" class="input" placeholder="Contoh: teknisi wanita 20-an, rambut pendek, sinis tapi lembut pada hewan"></textarea>
          </div>
          <div>
            <label class="muted text-sm">Premis Cerita</label>
            <textarea id="premis" class="input" placeholder="Contoh: menemukan portal mini di laci meja, membawa pulang kucing dari dimensi lain"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="muted text-sm">Gaya Visual</label>
              <select id="visual" class="input">
                <option>Live-Action - Sinematik Realistis</option>
                <option>Live-Action - Dokumenter (Handheld)</option>
                <option>Anime - Modern (Hibrida 2.5D)</option>
                <option>3D - Hiper-realistis (Unreal Engine)</option>
              </select>
            </div>
            <div>
              <label class="muted text-sm">Bahasa Audio</label>
              <select id="lang" class="input">
                <option>id-ID</option><option>en-US</option>
              </select>
            </div>
          </div>
          <div>
            <label class="muted text-sm">(Opsional) Arahan Cerita</label>
            <input id="arah" class="input" placeholder="Contoh: akhir open ending, tone bittersweet"/>
          </div>
        </div>

        <!-- AFILIASI -->
        <div id="afiliasiFields" class="hidden space-y-3">
          <div>
            <label class="muted text-sm">Nama Produk / Merek</label>
            <input id="brand" class="input" placeholder="Contoh: Zenoora"/>
          </div>
          <div>
            <label class="muted text-sm">Premis Video (8 detik)</label>
            <textarea id="premisAd" class="input" placeholder="Contoh: transisi objek biasa ‚Üí versi aesthetic, close-up detail, senyum di akhir"></textarea>
          </div>
          <div>
            <label class="muted text-sm">2‚Äì3 Kelebihan Utama (pisah koma / baris)</label>
            <textarea id="benefit" class="input" placeholder="bahan nyaman, desain minimal, muat banyak"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="muted text-sm">CTA</label>
              <input id="cta" class="input" value="KLIK KERANJANG KUNING / BELI SEKARANG"/>
            </div>
            <div>
              <label class="muted text-sm">Bahasa Audio</label>
              <select id="langAd" class="input">
                <option>id-ID</option><option>en-US</option>
              </select>
            </div>
          </div>
          <p class="muted text-xs">Guard: tanpa logo, harga, klaim kesehatan berlebih‚Äîakan diset otomatis di JSON.</p>
        </div>

        <div class="hr my-2"></div>

        <div class="flex gap-2 flex-wrap">
          <button id="genBtn" class="btn btn-primary">‚ö° Hasilkan Prompt JSON</button>
          <button id="assistScenes" class="btn btn-ghost">‚ú® AI Assist: Isi 3 Scene</button>
          <button id="assistCopy" class="btn btn-ghost">üß™ AI Perbaiki VO</button>
        </div>

        <div class="hr my-2"></div>

        <!-- IMAGE GEN -->
        <div class="space-y-2">
          <label class="muted text-sm">Prompt Gambar (konsep karakter/produk)</label>
          <textarea id="imgPrompt" class="input" placeholder="cinematic portrait, diffused lighting, film grain, 85mm bokeh"></textarea>
          <div class="grid grid-cols-3 gap-2">
            <input id="imgW" class="input" type="number" value="768" min="256" step="64" title="Width">
            <input id="imgH" class="input" type="number" value="1024" min="256" step="64" title="Height">
            <input id="imgSteps" class="input" type="number" value="28" min="10" max="60" step="1" title="Steps">
          </div>
          <button id="genImgBtn" class="btn btn-ghost">üñºÔ∏è Generate Gambar</button>
          <div id="imgOut" class="mt-2"></div>
          <p class="muted text-xs">Catatan: <b>Midjourney</b> berjalan di Discord & tidak punya API resmi. Gunakan SD WebUI lokal untuk integrasi gratis.</p>
        </div>
      </div>

      <!-- PANEL KANAN -->
      <div class="card p-4 lg:col-span-2">
        <label class="muted text-sm mb-1 block">Output Prompt (JSON)</label>
        <textarea id="output" class="input mono min-h-[460px]" spellcheck="false" placeholder="Hasil prompt akan muncul di sini..."></textarea>
        <div class="mt-2 flex flex-wrap gap-2">
          <span class="muted text-xs">Struktur: <span class="kbd">engine</span>, <span class="kbd">global</span>, <span class="kbd">script/characters</span>, <span class="kbd">scenes[3]</span>.</span>
          <span class="muted text-xs">Shortcut: <span class="kbd">Ctrl/Cmd</span> + <span class="kbd">Enter</span> = Generate.</span>
          <button id="copyBtn" class="btn btn-ghost ml-auto">üìã Salin JSON</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== UTIL =====
    const el = id => document.getElementById(id);
    const sanitize = s => (s||'').toString().trim();
    const LS = {
      textProvider: 'aionade_text_provider',
      hfKey: 'aionade_hf_key',
      hfModel: 'aionade_hf_model',
      orKey: 'aionade_or_key',
      orModel: 'aionade_or_model',
      imgProvider:
